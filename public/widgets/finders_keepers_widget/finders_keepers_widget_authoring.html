<div ng-controller="GameAuthoringCtrl as authoring" class="container game authoring">
  <game-editor content-controller="GameContentCtrl as content">
    <div ng-include="'/components/authoring/game/editor-header.html'"></div>

    <div class="sections">
        <div class="section">
            <div ng-include="'/components/authoring/game/common-start.html'"></div>
        </div>
        <!-- Instructions -->
        <div class="section">
        <div class="form-group">
          <h3 class="col-sm-2">Instructions</h3>
        </div>

        <div class="form-group">
          <div class="col-sm-12">
            <textarea class="form-control" placeholder="Instructions" ng-model="content.round.instructions.content" rows="5"></textarea>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-6">
            <label>
              <select class="form-control select-inline"
                      ng-model="content.round.instructions.align"
                      ng-init="content.round.instructions.align = content.round.instructions.align ? content.round.instructions.align : 'center'">
                <option value="center">Center Align</option>
                <option value="left">Left Align</option>
              </select>
            </label>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-12">
            <strong>Font Size</strong>
            <label class="inline-checkbox-label" >
              <select ng-model="content.round.instructions.font_size">
                <option ng-repeat="fontSize in [10, 12, 14, 16, 18, 20, 22, 24]"
                        value="{{fontSize}}"
                        ng-selected="fontSize == content.round.instructions.font_size">{{fontSize}}</option>
              </select>
            </label>
          </div>
        </div>

        <br/>
        <div class="form-group">
          <div class="col-sm-12">
            <textarea class="form-control" placeholder="Prompt" ng-model="content.round.prompt.content"
                      rows="{{content.round.instructions_img ? 1 : 5}}"
                      ng-readonly="content.round.instructions_img"></textarea>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-12">
            <p>
              <input type="file"
                     accept="image/*"
                     onchange="angular.element(this).scope().fileChanged(this)"/>
            </p>
            <p class="help-block">
              Upload an image to use as your prompt.
            </p>
            <p>
              <button class="btn btn-danger" ng-if="content.round.instructions_img" ng-click="content.deleteImg()">
                Remove
              </button>
            </p>
          </div>
          <div class="col-sm-12" ng-if="content.round.instructions_img">
            <img ng-src="data:image/png;base64, {{content.round.instructions_img}}" alt="Instructions Image" class="prompt-img"/>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-6">
            <label>
              <select class="form-control select-inline"
                      ng-model="content.round.prompt.align"
                      ng-init="content.round.prompt.align = content.round.prompt.align ? content.round.prompt.align : 'center'">
                <option value="center">Center Align</option>
                <option value="left">Left Align</option>
              </select>
            </label>
          </div>
        </div>
      </div>

      <!-- Values -->
      <div class="section values">
        <div class="form-group">
          <h3 class="col-sm-2">Values</h3>

          <div class="col-sm-10 edit-btns">
            <button class="btn btn-primary" ng-click="content.add('values')"
                    ng-show="content.sections.values.editing">Add
            </button>
            <button class="btn btn-primary" ng-click="content.toggleEdit('values')">
              {{content.sections.values.editing ? 'Done' : 'Edit'}}
            </button>
          </div>
        </div>

        <div ng-include="'/components/authoring/game/editor-fontsize.html'"></div>

        <div class="form-group">
          <div class="col-sm-12">
            <strong>Picker Title</strong>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-12">
            <input type="text" class="form-control"
                   ng-readonly="!content.sections.values.editing"
                   placeholder="Pick" ng-model="content.round.titles.pick"/>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-12">
            <strong>Stacker Title</strong>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-12">
            <input type="text" class="form-control"
                   ng-readonly="!content.sections.values.editing"
                   placeholder="Stack" ng-model="content.round.titles.stack"/>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-12" style="margin-top: 10px;">
            <div class="form-group can-delete" ng-repeat="value in content.values">
              <div class="col-sm-9">
              <textarea class="form-control"
                        ng-readonly="!content.sections.values.editing"
                        placeholder="Value" ng-model="value.content"></textarea>
              </div>
              <div class="col-sm-2" ng-include="'/components/authoring/game/editor-sizepicker.html'"></div>
              <div class="col-sm-1">
                <button class="btn btn-danger"
                        ng-click="content.remove('values', value)"
                        ng-if="content.sections.values.editing">-
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Answers -->
      <div class="section answers">
        <div class="form-group">
          <h3 class="col-sm-2">Answers</h3>

          <div class="col-sm-10 edit-btns">
            <button class="btn btn-primary" ng-click="content.add('answers')"
                    ng-show="content.sections.answers.editing">Add
            </button>
            <button class="btn btn-primary" ng-click="content.toggleEdit('answers')">
              {{content.sections.answers.editing ? 'Done' : 'Edit'}}
            </button>
          </div>

          <div class="col-sm-12">
            <label>
              <input ng-model="content.round.disregard_order" type="checkbox" ng-disabled="!content.sections.answers.editing" class="inline-checkbox"/>
              Disregard Order
            </label>
          </div>

          <div class="col-sm-12" style="margin-top: 10px;">
            <div class="form-group can-delete" ng-repeat="answer in content.answers">
              <div class="col-sm-11">
                <select ng-model="answer.value"
                        ng-disabled="!content.sections.answers.editing" class="form-control">
                  <option
                    ng-repeat="value in content.values"
                    ng-selected="answer.value == value.id" value="{{value.id}}">{{value.content}}</option>
                </select>
              </div>
              <div class="col-sm-1">
                <button class="btn btn-danger"
                        ng-click="content.remove('answers', answer)"
                        ng-if="content.sections.answers.editing">-
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback -->
      <div class="section feedback">
        <!-- Normally we include the 'editor-general-feedback.html' here, but the feedback authoring for pick and stack is so different
             that is just wasn't useful -->
        <div class="form-group">
          <h3 class="col-sm-5">Feedback</h3>

          <div class="col-sm-7 edit-btns">
            <button class="btn btn-primary" ng-click="content.toggleEdit('feedback')">
              {{content.sections.feedback.editing ? 'Done' : 'Edit'}}
            </button>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-3">
            Correct "Pick" Feedback
          </div>
          <div class="col-sm-9">
            <textarea class="form-control"
                      rows="6"
                      ng-model="content.round.general_correct" ng-readonly="!content.sections.feedback.editing">
              {{content.round.general_correct}}
            </textarea>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-3">
            Correct "Stack" Feedback
          </div>
          <div class="col-sm-9">
            <textarea class="form-control"
                      rows="6"
                      ng-model="content.round.general_stack_correct" ng-readonly="!content.sections.feedback.editing">
              {{content.round.general_stack_correct}}
            </textarea>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-3">
            Incorrect "Stack" Feedback
          </div>
          <div class="col-sm-9">
            <textarea class="form-control"
                      rows="6"
                      ng-model="content.round.general_incorrect" ng-readonly="!content.sections.feedback.editing">
              {{content.round.general_incorrect}}
            </textarea>
          </div>
        </div>

        <!-- Pick Feedback -->
        <div class="form-group">
          <div class="col-sm-12">
            "Pick" Incorrect Feedback
          </div>
        </div>
        <div class="form-group" ng-show="content.sections.feedback.editing">
          <div class="col-sm-12 edit-btns">
            <button class="btn btn-primary" ng-click="content.add('feedbackPick')">Add
            </button>
          </div>
        </div>
        <div class="form-group can-delete" ng-repeat="feedback in content.feedback | filter: {type: 'pick'}">
          <div class="col-sm-3">
            <select class="form-control" ng-model="feedback.answer">
              <option ng-repeat="value in content.values" value="{{value.id}}" ng-selected="feedback.answer == value.id">{{value.content}}</option>
            </select>
          </div>

          <div class="col-sm-8">
            <textarea class="form-control"
                      rows="6"
                      ng-model="feedback.content" ng-readonly="!content.sections.feedback.editing">
              {{feedback.content}}
            </textarea>
          </div>
          <div class="col-sm-1">
            <button class="btn btn-danger"
                    ng-click="content.remove('feedback', feedback)"
                    ng-if="content.sections.feedback.editing">-
            </button>
          </div>
        </div>

        <!-- Stack Feedback -->
        <div class="form-group">
          <div class="col-sm-12">
            "Stack" Incorrect Feedback
          </div>
        </div>
        <div class="form-group" ng-show="content.sections.feedback.editing">
          <div class="col-sm-12 edit-btns">
            <button class="btn btn-primary" ng-click="content.add('feedbackStack')">Add
            </button>
          </div>
        </div>
        <div class="form-group can-delete" ng-repeat="feedback in content.feedback | filter: {type: 'stack'}">
          <div class="col-sm-10">
            <div class="row" ng-if="content.sections.feedback.editing">
              <button class="btn btn-primary col-sm-3" ng-click="content.addCondition(feedback)"
                      style="margin-bottom: 10px;">Add Answer
              </button>
            </div>
            <div class="form-group">
              <div class="col-sm-4" ng-repeat="condition in feedback.conditions">
                <select class="form-control" style="width: 70%;"
                        ng-model="condition.content"
                        ng-change="condition.content"
                        ng-disabled="!content.sections.feedback.editing">
                  <option></option>
                  <option ng-repeat="value in content.values" ng-selected="condition.content == value.content" value="{{value.content}}">
                    {{value.content}}
                  </option>
                </select>
                <button class="btn btn-danger" ng-click="content.removeCondition(feedback, condition)"
                        ng-if="content.sections.feedback.editing">-
                </button>
              </div>
            </div>
          </div>
          <div class="col-sm-11">
            <textarea class="form-control"
                      rows="6"
                      ng-model="feedback.content" ng-readonly="!content.sections.feedback.editing">
              {{feedback.content}}
            </textarea>
          </div>
          <div class="col-sm-1">
            <button class="btn btn-danger"
                    ng-click="content.remove('feedback', feedback)"
                    ng-if="content.sections.feedback.editing">-
            </button>
          </div>
        </div>
      </div>
    </div>
  </game-editor>
</div>